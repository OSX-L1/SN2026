<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUNNY Blind System (Stable)</title>
    
    <!-- 1. React & ReactDOM (Core) -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 2. Babel (Compiler) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- 3. Tailwind CSS (Styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 4. PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- 5. Firebase Compat (Robust Version) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f1f5f9; /* Slate-100 */
        }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        /* Printable Area */
        .printable-content { background: white; color: black; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Configuration ---
        const APP_ID = 'sunny-blind-system-v2';
        const DEFAULT_CONFIG = {
            logoUrl: 'https://cdn-icons-png.flaticon.com/512/2807/2807469.png',
            hardwarePrice: 1956,
            topRailPrice: 200,
            bottomRailPrice: 150,
            slingPrice: 138,
            fabricFactor: 1.2,
            basswoodPrice: 789,
            fauxwoodPrice: 750,
        };

        // --- Icons System (Embedded SVG - No External Load) ---
        const Icon = ({ p, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{p}</svg>
        );
        const Icons = {
            Home: <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>,
            Calc: <path d="M4 2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z M8 6h8 M16 14v4 M16 10h.01 M12 10h.01 M8 10h.01 M12 14h.01 M8 14h.01 M12 18h.01 M8 18h.01"/>,
            Box: <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>,
            Settings: <path d="M12.22 2h-.44a2 2 0 0 1-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/>,
            Trash: <path d="M3 6h18 M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6 M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>,
            Plus: <path d="M12 5v14 M5 12h14"/>,
            File: <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6"/>,
            X: <path d="M18 6L6 18 M6 6l12 12"/>,
            Check: <polyline points="20 6 9 17 4 12"/>,
            WifiOff: <><line x1="1" y1="1" x2="23" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.58 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></>,
            Wifi: <><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></>,
            Download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4 M7 10l5 5 5-5 M12 15V3"/>
        };

        // --- Helper ---
        const formatTHB = (n) => new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB', minimumFractionDigits: 0 }).format(n);

        // ==========================================
        //  The App Component
        // ==========================================
        const App = () => {
            const [tab, setTab] = useState('calc');
            const [status, setStatus] = useState('offline'); // 'loading', 'online', 'offline'
            const [config, setConfig] = useState(DEFAULT_CONFIG);
            const [showAdmin, setShowAdmin] = useState(false);
            const [items, setItems] = useState([]);

            // Refs for Firebase
            const dbRef = useRef(null);
            const authRef = useRef(null);

            // 1. Initialization Logic (Robust)
            useEffect(() => {
                const initializeSystem = async () => {
                    setStatus('loading');
                    
                    // A. Load Local Config First (Instant UI)
                    const localConfig = localStorage.getItem('sunny_config');
                    if (localConfig) {
                        try { setConfig({ ...DEFAULT_CONFIG, ...JSON.parse(localConfig) }); } catch(e){}
                    }

                    // B. Try Firebase Connection
                    try {
                        // Check environment variables first, else fallback to user config
                        let fbConfig = {
                             apiKey: "AIzaSyCsi2LJcpVAiFBXnmc5XgiIt3UlNFeo2lI",
                             authDomain: "sn2026-9e19e.firebaseapp.com",
                             projectId: "sn2026-9e19e",
                             storageBucket: "sn2026-9e19e.firebasestorage.app",
                             messagingSenderId: "45923511775",
                             appId: "1:45923511775:web:04eca2038d60bfa393a86a"
                        };

                        if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                             const envConf = JSON.parse(__firebase_config);
                             if (Object.keys(envConf).length > 0) fbConfig = envConf;
                        }

                        if (typeof firebase !== 'undefined') {
                            if (!firebase.apps.length) firebase.initializeApp(fbConfig);
                            authRef.current = firebase.auth();
                            dbRef.current = firebase.firestore();

                            // Auth
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                await authRef.current.signInWithCustomToken(__initial_auth_token);
                            } else {
                                await authRef.current.signInAnonymously();
                            }

                            // Listener
                            const docRef = dbRef.current.doc(`artifacts/${APP_ID}/public/data/config/main`);
                            docRef.onSnapshot((snap) => {
                                setStatus('online');
                                if (snap.exists) {
                                    const data = snap.data();
                                    setConfig(prev => ({ ...prev, ...data }));
                                    localStorage.setItem('sunny_config', JSON.stringify(data)); // Sync to local
                                } else {
                                    // Create if missing
                                    docRef.set(DEFAULT_CONFIG).catch(err => console.warn("Write perm error (ok in offline)", err));
                                }
                            }, (err) => {
                                console.warn("Firestore connect lost:", err);
                                setStatus('offline');
                            });
                        } else {
                            throw new Error("Firebase SDK not loaded");
                        }
                    } catch (err) {
                        console.error("Running Offline Mode:", err);
                        setStatus('offline');
                    }
                };

                initializeSystem();
            }, []);

            // 2. Save Logic (Hybrid)
            const handleSaveConfig = async (newConfig) => {
                setConfig(newConfig);
                localStorage.setItem('sunny_config', JSON.stringify(newConfig)); // Always save local
                
                if (status === 'online' && dbRef.current) {
                    try {
                        await dbRef.current.doc(`artifacts/${APP_ID}/public/data/config/main`).set(newConfig);
                    } catch(e) {
                        alert("บันทึกออนไลน์ล้มเหลว (บันทึกในเครื่องแทนแล้ว)");
                    }
                } else {
                    alert("บันทึกในเครื่องเรียบร้อย (โหมดออฟไลน์)");
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl overflow-hidden flex flex-col relative sm:rounded-[30px] sm:my-4 sm:border border-slate-200">
                    {/* --- Top Bar --- */}
                    <div className="h-16 flex justify-between items-center px-6 bg-white/80 backdrop-blur-md border-b sticky top-0 z-50">
                        <div className="flex items-center gap-2">
                             <img src={config.logoUrl} className="h-8 w-auto object-contain" onError={(e) => e.target.style.display='none'} />
                             <span className="font-bold text-slate-700 tracking-tight">SUNNY</span>
                        </div>
                        <div className={`flex items-center gap-1.5 text-xs font-bold px-2 py-1 rounded-full ${status === 'online' ? 'bg-green-100 text-green-600' : 'bg-slate-100 text-slate-500'}`}>
                            <Icon p={status === 'online' ? Icons.Wifi : Icons.WifiOff} size={14} />
                            {status === 'online' ? 'ONLINE' : 'OFFLINE'}
                        </div>
                    </div>

                    {/* --- Content Area --- */}
                    <div className="flex-1 overflow-y-auto pb-24 bg-slate-50">
                        {tab === 'home' && <HomeView setTab={setTab} config={config} />}
                        {tab === 'calc' && <CalcView config={config} items={items} setItems={setItems} />}
                        {tab === 'stock' && <StockView />}
                    </div>

                    {/* --- Bottom Nav --- */}
                    <div className="h-20 bg-white border-t flex justify-around items-center px-2 absolute bottom-0 w-full z-40">
                        <NavBtn active={tab==='home'} onClick={()=>setTab('home')} icon={Icons.Home} label="หน้าหลัก" />
                        <NavBtn active={tab==='stock'} onClick={()=>setTab('stock')} icon={Icons.Box} label="สต็อก" />
                        <NavBtn active={tab==='calc'} onClick={()=>setTab('calc')} icon={Icons.Calc} label="คำนวณ" />
                        <NavBtn active={showAdmin} onClick={()=>setShowAdmin(true)} icon={Icons.Settings} label="ตั้งค่า" />
                    </div>

                    {/* --- Admin Modal --- */}
                    {showAdmin && <AdminModal config={config} onSave={handleSaveConfig} onClose={()=>setShowAdmin(false)} />}
                </div>
            );
        };

        // --- Views ---

        const HomeView = ({ setTab, config }) => (
            <div className="p-8 flex flex-col items-center justify-center min-h-[60vh] text-center fade-in">
                <img src={config.logoUrl} className="h-32 object-contain mb-6 drop-shadow-lg" />
                <h1 className="text-2xl font-bold text-slate-800 mb-2">ระบบร้านม่านม้วน</h1>
                <p className="text-slate-500 mb-8">จัดการคำนวณราคาและออกใบเสนอราคา<br/>ได้อย่างรวดเร็วและแม่นยำ</p>
                <button onClick={() => setTab('calc')} className="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition active:scale-95 flex items-center gap-2">
                    <Icon p={Icons.Calc} /> เริ่มใช้งาน
                </button>
            </div>
        );

        const StockView = () => (
            <div className="p-10 flex flex-col items-center justify-center min-h-[60vh] text-center fade-in opacity-50">
                <div className="bg-slate-200 p-6 rounded-full mb-4"><Icon p={Icons.Box} size={40} className="text-slate-400" /></div>
                <h2 className="text-xl font-bold text-slate-600">กำลังพัฒนา</h2>
                <p className="text-slate-400">ระบบเช็คสต็อกจะเปิดใช้งานเร็วๆ นี้</p>
            </div>
        );

        const CalcView = ({ config, items, setItems }) => {
            const [mode, setMode] = useState('ext'); // ext, int, wood
            const [form, setForm] = useState({ w: '', h: '', price: '', qty: 1, side: 'ขวา', wood: 'BASSWOOD' });
            const [showQuote, setShowQuote] = useState(false);

            const add = () => {
                const w = parseFloat(form.w), h = parseFloat(form.h), qty = parseInt(form.qty);
                let p = parseFloat(form.price);
                if (mode === 'wood') p = (form.wood === 'BASSWOOD' ? config.basswoodPrice : config.fauxwoodPrice);
                
                if (!w || !h || !p || !qty) return alert('กรุณากรอกข้อมูลให้ครบ');

                const wm = w/100, hm = h/100;
                // Calculation Logic
                let fabricCost = wm * hm * (mode==='wood' ? 1.2 : config.fabricFactor) * p;
                let total = fabricCost;
                
                let detail = {};
                if (mode === 'ext') {
                    const hw = config.hardwarePrice;
                    const top = config.topRailPrice * wm;
                    const bot = config.bottomRailPrice * wm;
                    const sling = config.slingPrice * hm;
                    total = fabricCost + hw + top + bot + sling;
                    detail = { hw, top, bot, sling };
                }

                setItems([...items, { 
                    id: Date.now(), mode, w, h, qty, side: form.side, price: p, total: total * qty, unitTotal: total,
                    typeName: mode==='ext'?'ม่านภายนอก':(mode==='int'?'ม่านภายใน':`มู่ลี่ไม้ ${form.wood}`),
                    detail
                }]);
                setForm(prev => ({...prev, w: '', h: ''})); // Reset size
            };

            const grandTotal = items.reduce((a, b) => a + b.total, 0);

            return (
                <div className="p-5 fade-in">
                    {/* Type Selector */}
                    <div className="flex bg-slate-200 p-1 rounded-xl mb-6">
                        {[['ext','ภายนอก'],['int','ภายใน'],['wood','มู่ลี่ไม้']].map(([k,l]) => (
                            <button key={k} onClick={()=>setMode(k)} className={`flex-1 py-2 rounded-lg text-sm font-bold transition ${mode===k ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>{l}</button>
                        ))}
                    </div>

                    {/* Form */}
                    <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 mb-6 space-y-4">
                        {mode === 'wood' && (
                            <div className="flex gap-2">
                                {['BASSWOOD','FAUX WOOD'].map(t => (
                                    <button key={t} onClick={()=>setForm({...form, wood:t})} className={`flex-1 py-2 border-2 rounded-lg text-xs font-bold ${form.wood===t ? 'border-amber-500 bg-amber-50 text-amber-700' : 'border-slate-100 text-slate-400'}`}>{t}</button>
                                ))}
                            </div>
                        )}
                        <div className="flex gap-4">
                            <Input label="กว้าง (cm)" val={form.w} set={v=>setForm({...form, w:v})} />
                            <Input label="สูง (cm)" val={form.h} set={v=>setForm({...form, h:v})} />
                        </div>
                        <div className="flex gap-4">
                            {mode !== 'wood' ? 
                                <Input label="ราคาผ้า/ตร.ล." val={form.price} set={v=>setForm({...form, price:v})} /> :
                                <div className="flex-1"><label className="text-xs font-bold text-slate-400">ราคา/ตร.ล.</label><div className="bg-slate-100 p-3 rounded-lg font-bold text-slate-600">{formatTHB(form.wood === 'BASSWOOD' ? config.basswoodPrice : config.fauxwoodPrice)}</div></div>
                            }
                            <div className="flex-1">
                                <label className="text-xs font-bold text-slate-400 mb-1 block">จำนวน</label>
                                <div className="flex items-center bg-slate-100 rounded-lg overflow-hidden">
                                    <button onClick={()=>setForm({...form, qty:Math.max(1, form.qty-1)})} className="p-3 hover:bg-slate-200"><Icon p={<path d="M5 12h14"/>} /></button>
                                    <div className="flex-1 text-center font-bold">{form.qty}</div>
                                    <button onClick={()=>setForm({...form, qty:form.qty+1})} className="p-3 hover:bg-slate-200"><Icon p={Icons.Plus} /></button>
                                </div>
                            </div>
                        </div>
                        <div>
                             <label className="text-xs font-bold text-slate-400 mb-2 block">โซ่/สลิง</label>
                             <div className="flex gap-3">
                                {['ซ้าย','ขวา'].map(s => (
                                    <button key={s} onClick={()=>setForm({...form, side:s})} className={`flex-1 py-2 rounded-lg border-2 text-sm font-bold ${form.side===s ? 'border-blue-500 text-blue-600 bg-blue-50' : 'border-slate-100 text-slate-400'}`}>{s}</button>
                                ))}
                             </div>
                        </div>
                        <button onClick={add} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow hover:bg-blue-700 active:scale-95 transition flex justify-center gap-2">
                            <Icon p={Icons.Plus} /> เพิ่มรายการ
                        </button>
                    </div>

                    {/* List */}
                    {items.length > 0 && (
                        <div className="space-y-3 pb-20">
                            <div className="flex justify-between items-end px-2">
                                <span className="font-bold text-slate-700">รายการ ({items.length})</span>
                                <button onClick={()=>setItems([])} className="text-xs text-red-400 font-bold flex items-center gap-1"><Icon p={Icons.Trash} size={14} /> ล้าง</button>
                            </div>
                            {items.map(item => (
                                <div key={item.id} className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm relative">
                                    <button onClick={()=>setItems(items.filter(i=>i.id!==item.id))} className="absolute top-2 right-2 text-slate-300 hover:text-red-400"><Icon p={Icons.X} size={18} /></button>
                                    <div className="flex gap-2 mb-2">
                                        <div className={`w-2 h-2 rounded-full mt-1.5 ${item.mode==='ext'?'bg-orange-400':(item.mode==='int'?'bg-blue-400':'bg-amber-500')}`}></div>
                                        <div>
                                            <div className="font-bold text-slate-700">{item.typeName}</div>
                                            <div className="text-xs text-slate-400">{item.w}x{item.h} cm | {item.qty} ชุด ({item.side})</div>
                                        </div>
                                    </div>
                                    <div className="text-right font-bold text-blue-600 text-lg">{formatTHB(item.total)}</div>
                                </div>
                            ))}
                            <button onClick={()=>setShowQuote(true)} className="w-full bg-slate-800 text-white py-4 rounded-xl font-bold shadow-lg flex justify-center gap-2 mt-4">
                                <Icon p={Icons.File} /> สรุปราคา {formatTHB(grandTotal)}
                            </button>
                        </div>
                    )}
                    
                    {showQuote && <QuoteModal items={items} total={grandTotal} close={()=>setShowQuote(false)} />}
                </div>
            );
        };

        // --- Modals ---

        const QuoteModal = ({ items, total, close }) => {
            const ref = useRef();
            const dl = async (type) => {
                const cvs = await html2canvas(ref.current, { scale: 2 });
                if (type === 'img') {
                    const a = document.createElement('a'); a.href = cvs.toDataURL(); a.download = 'quote.png'; a.click();
                } else {
                    const pdf = new jspdf.jsPDF('p','mm','a4');
                    pdf.addImage(cvs.toDataURL('image/png'), 'PNG', 0, 0, 210, (cvs.height * 210) / cvs.width);
                    pdf.save('quote.pdf');
                }
            };

            return (
                <div className="fixed inset-0 bg-black/80 z-[60] flex justify-center items-end sm:items-center p-4 backdrop-blur-sm fade-in">
                    <div className="bg-white w-full max-w-lg rounded-2xl overflow-hidden flex flex-col max-h-[90vh]">
                         <div className="p-4 border-b flex justify-between items-center bg-slate-50">
                            <h3 className="font-bold text-slate-700">ใบเสนอราคา</h3>
                            <button onClick={close} className="p-2 bg-slate-200 rounded-full"><Icon p={Icons.X} /></button>
                         </div>
                         <div className="flex-1 overflow-y-auto bg-slate-100 p-4">
                            <div ref={ref} className="bg-white p-6 rounded-none sm:rounded-lg shadow-sm printable-content min-h-[400px]">
                                <h1 className="text-2xl font-bold text-center mb-6">ใบเสนอราคา</h1>
                                <div className="space-y-4">
                                    {items.map((it, i) => (
                                        <div key={it.id} className="flex justify-between border-b pb-2">
                                            <div>
                                                <div className="font-bold text-sm">{i+1}. {it.typeName}</div>
                                                <div className="text-xs text-slate-500">{it.w}x{it.h} cm x {it.qty}</div>
                                            </div>
                                            <div className="font-bold">{formatTHB(it.total)}</div>
                                        </div>
                                    ))}
                                    <div className="flex justify-between pt-4 border-t border-black">
                                        <div className="font-bold text-lg">รวมทั้งสิ้น</div>
                                        <div className="font-bold text-lg text-blue-600">{formatTHB(total)}</div>
                                    </div>
                                </div>
                            </div>
                         </div>
                         <div className="p-4 border-t flex gap-3 bg-white">
                            <button onClick={()=>dl('pdf')} className="flex-1 bg-red-500 text-white py-3 rounded-xl font-bold flex justify-center gap-2"><Icon p={Icons.Download} /> PDF</button>
                            <button onClick={()=>dl('img')} className="flex-1 bg-indigo-500 text-white py-3 rounded-xl font-bold flex justify-center gap-2"><Icon p={Icons.Box} /> รูปภาพ</button>
                         </div>
                    </div>
                </div>
            )
        };

        const AdminModal = ({ config, onSave, onClose }) => {
            const [localConf, setLocalConf] = useState(config);
            const [pass, setPass] = useState('');
            const [auth, setAuth] = useState(false);

            if (!auth) return (
                <div className="fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-6 backdrop-blur-sm fade-in">
                    <div className="bg-white w-full max-w-sm p-6 rounded-2xl text-center">
                        <div className="bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"><Icon p={Icons.Settings} size={30} className="text-slate-400"/></div>
                        <h3 className="font-bold text-lg mb-4">เข้าสู่ระบบหลังบ้าน</h3>
                        <input type="password" value={pass} onChange={e=>setPass(e.target.value)} placeholder="รหัสผ่าน" className="w-full bg-slate-100 p-3 rounded-xl text-center font-bold mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <div className="flex gap-2">
                            <button onClick={onClose} className="flex-1 py-3 text-slate-400 font-bold">ยกเลิก</button>
                            <button onClick={()=>{ if(pass==='1988') setAuth(true); else alert('รหัสผิด'); }} className="flex-1 bg-slate-800 text-white py-3 rounded-xl font-bold">เข้าสู่ระบบ</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 backdrop-blur-sm fade-in">
                    <div className="bg-white w-full max-w-sm rounded-2xl overflow-hidden flex flex-col max-h-[80vh]">
                        <div className="p-4 border-b flex justify-between items-center"><h3 className="font-bold">ตั้งค่าราคากลาง</h3><button onClick={onClose}><Icon p={Icons.X}/></button></div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-4">
                            <Input label="Logo URL" val={localConf.logoUrl} set={v=>setLocalConf({...localConf, logoUrl:v})} type="text" />
                            <div className="h-px bg-slate-100 my-2"></div>
                            <Input label="ราคาอุปกรณ์ภายนอก" val={localConf.hardwarePrice} set={v=>setLocalConf({...localConf, hardwarePrice:parseFloat(v)})} />
                            <Input label="รางบน" val={localConf.topRailPrice} set={v=>setLocalConf({...localConf, topRailPrice:parseFloat(v)})} />
                            <Input label="รางล่าง" val={localConf.bottomRailPrice} set={v=>setLocalConf({...localConf, bottomRailPrice:parseFloat(v)})} />
                            <Input label="สลิง" val={localConf.slingPrice} set={v=>setLocalConf({...localConf, slingPrice:parseFloat(v)})} />
                            <div className="h-px bg-slate-100 my-2"></div>
                            <Input label="BASSWOOD" val={localConf.basswoodPrice} set={v=>setLocalConf({...localConf, basswoodPrice:parseFloat(v)})} />
                            <Input label="FAUX WOOD" val={localConf.fauxwoodPrice} set={v=>setLocalConf({...localConf, fauxwoodPrice:parseFloat(v)})} />
                        </div>
                        <div className="p-4 border-t">
                            <button onClick={()=>{onSave(localConf); onClose();}} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold flex justify-center gap-2"><Icon p={Icons.Check}/> บันทึก</button>
                        </div>
                    </div>
                </div>
            );
        };

        const Input = ({ label, val, set, type="number" }) => (
            <div>
                <label className="text-xs font-bold text-slate-400 mb-1 block">{label}</label>
                <input type={type} value={val} onChange={e=>set(e.target.value)} className="w-full bg-slate-100 p-3 rounded-lg font-bold text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-200 transition" />
            </div>
        );

        const NavBtn = ({ active, onClick, icon, label }) => (
            <button onClick={onClick} className={`flex flex-col items-center w-16 transition ${active ? 'text-blue-600 scale-105' : 'text-slate-300 hover:text-slate-400'}`}>
                <Icon p={icon} size={24} strokeWidth={active?2.5:2} />
                <span className="text-[10px] font-bold mt-1">{label}</span>
            </button>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
